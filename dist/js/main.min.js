Site={mobileThreshold:601,scrollToSpeed:300,loadingDelay:1500,init:function(){var _this=this;$(window).resize(function(){_this.onResize()}),$(document).ready(function(){$("#portraits").length&&(Site.Portraits.init(),Site.Player.init()),$(".paypal-form-holder").length&&Site.Paypal.init(),$("#support-form").length&&Site.SupportForm.init(),$(".slick-slide").length>1&&$(".slick-container").slick({infinite:!0,speed:300,slidesToShow:1,centerMode:!0,variableWidth:!0,dots:!0,arrows:!1,focusOnSelect:!0}),$(".js-menu-toggle").on("click",function(){$("#mobile-menu").toggleClass("open")})})},removeLoading:function(){var _this=this;setTimeout(function(){$("body").removeClass("loading")},_this.loadingDelay)},onResize:function(){},fixWidows:function(){$(".js-fix-widows").each(function(){var string=$(this).html();string=string.replace(/ ([^ ]*)$/,"&nbsp;$1"),$(this).html(string)})},getHashVideoId:function(){var hash=location.hash.split("/");if("portrait"===hash[1]){return hash[hash.length-1]}return!1}},Site.Paypal={init:function(){var _this=this;$(".paypal-form-holder form").each(function(){_this.styleForm($(this))}),$(".paypal-form-holder").removeClass("u-hidden")},styleForm:function($form){var $buy=$form.find('input[name="submit"]'),$select=$form.find("select");$buy.attr("type","submit"),$buy.attr("value","Buy"),$buy.wrap('<div class="grid-item item-s-6"></div>'),$select.length&&($form.prepend($select),$form.find("table").remove(),$select.wrap('<div class="grid-item item-s-6"></div>'))}},Site.Player={playerOptions:{controls:0,modestbranding:1,rel:0,title:0,showinfo:0,fs:0},init:function(){var _this=this;!0===WP.wp_debug&&!0===WP.isAdmin&&(_this.playerOptions.controls=1),_this.$wrapper=$("#player-container"),_this.$container=$("#portraits"),_this.bind()},setVideosList:function(list){var _this=this;list&&(_this.list=list)},bind:function(){var _this=this;$(window).on("updatedyoutubelist",function(event,data){_this.setVideosList(data.youtubeIds)})},initYoutube:function(){var _this=this;Site.removeLoading(),_this.player=new YT.Player("player-iframe",{playerVars:_this.playerOptions}),$(window).resize(_this.onResize.bind(_this)),_this.player.addEventListener("onReady",_this.handleVideoReady.bind(this)),_this.player.addEventListener("onStateChange",_this.handleVideoStateChange.bind(this)),$(window).resize(_this.onResize.bind(_this))},handleVideoReady:function(event){Site.Portraits.checkHash()},handleVideoStateChange:function(event){var _this=this;switch(event.data){case-1:_this.fadeOut();break;case 0:_this.fadeOut(),_this.list&&_this.nextVideo();break;case 1:_this.fadeIn();break;case 3:_this.fadeOut()}},fadeOut:function(){this.$container.removeClass("show")},fadeIn:function(){this.$container.addClass("show")},openVideo:function(){var _this=this;_this.$container.addClass("video"),_this.sizeIframe()},closeVideo:function(){var _this=this;_this.$container.removeClass("video"),_this.closeIframe(),_this.player.stopVideo(),location.hash=""},scrollIn:function(){$("body").scrollTo(0,Site.scrollToSpeed)},playVideo:function(videoId,list){var _this=this;_this.openVideo(),_this.player.loadVideoById(videoId),void 0!==list&&_this.setVideosList(list)},nextVideo:function(){var _this=this,currentVideo=Site.getHashVideoId();if(currentVideo=_this.list.indexOf(currentVideo),_this.list.length>currentVideo+1){var nextVideo=_this.list[currentVideo+1];location.hash="#!/portrait/"+nextVideo}else _this.closeVideo()},closeIframe:function(){$("#player-wrapper").css({height:0})},sizeIframe:function(){var _this=this,windowWidth=$(window).width(),windowHeight=$(window).height(),headerHeight=$("#header").outerHeight(),filterHeight=$("#portraits-filters-container").outerHeight(),landscapeIframeHeight=windowHeight-(headerHeight+filterHeight),portraitIframeHeight=windowWidth/16*9;_this.$container.hasClass("video")&&(windowWidth<=windowHeight/9*16&&portraitIframeHeight<=landscapeIframeHeight?($("#player-wrapper").css({height:portraitIframeHeight}),$("#player-iframe").css({width:"100%"})):($("#player-wrapper").css({height:landscapeIframeHeight}),$("#player-iframe").css({width:landscapeIframeHeight/9*16})))},onResize:function(){this.sizeIframe()}},Site.Portraits={init:function(){var _this=this;_this.$form=$("#portraits-filters"),_this.$filters=_this.$form.find("select"),_this.$grid=$("#portraits-grid"),_this.$portraits=_this.$grid.find(".portrait"),_this.initGrid(),_this.bind()},initGrid:function(){var _this=this;_this.$grid.shuffle=new window.Shuffle(_this.$grid,{itemSelector:".portrait",sizer:"#portrait-sizer",filterMode:window.Shuffle.FilterMode.ALL}),_this.$grid[0].addEventListener("load",function(){var runs,update=function(){_this.$grid.shuffle.layout(),runs=!1};return function(){runs||(runs=!0,setTimeout(update,33))}}(),!0)},bind:function(){var _this=this;_this.$filters=$(".filter-select").on("change",_this.handleFilterChange.bind(_this)),$(window).on("hashchange",_this.handleHashChange.bind(_this)),_this.$grid.on("arrangeComplete",_this.handleArrangeComplete.bind(_this)),$(".portrait a").on("click",Site.Player.scrollIn)},checkHash:function(){var _this=this,videoId=Site.getHashVideoId();if(videoId){var list=_this.getFilteredYoutubeIds();Site.Player.playVideo(videoId,list)}},handleHashChange:function(event){this.checkHash()},getFilteredYoutubeIds:function(){return $(".shuffle-item--visible").toArray().map(function(val){return val.dataset.youtubeId})},handleArrangeComplete:function(event){var _this=this,youtubeIds=_this.getFilteredYoutubeIds();$(window).trigger("updatedyoutubelist",{youtubeIds:youtubeIds})},handleFilterChange:function(event){var _this=this,filterArray=_this.getFilterArray();_this.$grid.shuffle.filter(filterArray)},getFilterArray:function(){var _this=this,filterArray=[];return _this.$filters.each(function(){this.value&&filterArray.push(this.dataset.filter+"-"+this.value)}),filterArray}},window.onYouTubePlayerAPIReady=Site.Player.initYoutube.bind(Site.Player),Site.Map={options:{mapTypeControl:!1,fullscreenControl:!1,streetViewControl:!1,zoomControl:!1,center:{lat:-34.397,lng:150.644},minZoom:2,maxZoom:15,icon:{},styles:[{elementType:"geometry.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{elementType:"geometry.stroke",stylers:[{color:"#000000"},{visibility:"on"},{weight:.5}]},{elementType:"labels.text.fill",stylers:[{color:"#000000"}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]}]},dataStyle:{fillColor:"white",strokeWeight:1},markers:[],geoJSONURL:WP.themeUrl+"/dist/static/countries.geo.json",init:function(){var _this=this;_this.options.icon={url:WP.themeUrl+"/dist/img/truth-bubble.png",scaledSize:new google.maps.Size(75.5,55),anchor:new google.maps.Point(0,55)},_this.$grid=$("#portraits-grid"),_this.$portraits=_this.$grid.find(".portrait"),_this.$wrapper=$("#map-portraits-wrapper"),_this.$container=$("#map-container"),_this.map=new google.maps.Map(_this.$container[0],_this.options),_this.map.data.loadGeoJson(_this.geoJSONURL),_this.map.data.setStyle(_this.dataStyle);var bounds=new google.maps.LatLngBounds;_this.wrapperOffsetTop=_this.$wrapper.offset().top,_this.headerHeight=$("#header").outerHeight(!0),$(window).resize(_this.onResize.bind(_this)),WP.locations.length&&($(WP.locations).each(function(index,item){_this.markers[index]=new google.maps.Marker({map:_this.map,title:item.name,icon:_this.options.icon,position:{lat:parseInt(item.lat),lng:parseInt(item.lng)}}),!0===WP.wp_debug&&!0===WP.isAdmin&&(_this.markers[index]=new google.maps.Marker({map:_this.map,title:item.name,position:{lat:parseInt(item.lat),lng:parseInt(item.lng)}})),_this.markers[index].slug=item.slug,_this.markers[index].addListener("click",function(){_this.playPortraitsByLocation(this.slug)}),bounds.extend(_this.markers[index].getPosition())}),_this.map.setCenter(bounds.getCenter()),google.maps.event.addListenerOnce(_this.map,"bounds_changed",function(event){_this.map.setZoom(_this.map.getZoom()-1),_this.map.getZoom()>13&&_this.map.setZoom(4)}.bind(this)),_this.map.fitBounds(bounds)),_this.bindToggleMap(),_this.limitBounds(),_this.zoomButtons()},limitBounds:function(){var _this=this;google.maps.event.addListener(_this.map,"drag",function(){var sLat=_this.map.getBounds().getSouthWest().lat(),nLat=_this.map.getBounds().getNorthEast().lat();sLat<-85||nLat>85?_this.map.setOptions({center:new google.maps.LatLng(_this.mapCenter.lat(),_this.mapCenter.lng())}):_this.mapCenter=_this.map.getCenter()})},bindToggleMap:function(){var _this=this;$(".toggle-map").on("click",function(event){event.preventDefault(),_this.$wrapper.toggleClass("show-map"),$("body").scrollTo(_this.wrapperOffsetTop-_this.headerHeight,Site.scrollToSpeed)})},playPortraitsByLocation:function(location){var _this=this,list=[],filter='[data-groups*="location-'+location+'"]';_this.$portraits.filter(filter).each(function(index,element){list[index]=element.dataset.youtubeId}),Site.Player.playVideo(list[0],list),$("body").scrollTo(0,Site.scrollToSpeed)},zoomButtons:function(){var _this=this;$(".map-zoom-button").on("click",function(){var zoomChange=parseInt($(this).attr("data-zoom")),currentZoom=_this.map.getZoom();_this.map.setZoom(currentZoom+zoomChange)}),google.maps.event.addListener(_this.map,"zoom_changed",function(){var zoomLevel=_this.map.getZoom();zoomLevel<=_this.options.minZoom?$('.map-zoom-button[data-zoom="-1"]').addClass("disabled"):$('.map-zoom-button[data-zoom="-1"]').removeClass("disabled"),zoomLevel>=_this.options.maxZoom?$('.map-zoom-button[data-zoom="1"]').addClass("disabled"):$('.map-zoom-button[data-zoom="1"]').removeClass("disabled")})},onResize:function(){var _this=this;_this.wrapperOffsetTop=_this.$wrapper.offset().top,_this.headerHeight=$("#header").outerHeight(!0)}},Site.SupportForm={init:function(){var _this=this;_this.$form=$("#support-form"),_this.$form.length&&_this.bind()},bind:function(){var _this=this;_this.$form.on({submit:function(e){e.preventDefault();var data=$(this).serializeArray().reduce(function(obj,item){return obj[item.name]=item.value,obj},{});_this.submitForm(this,data)}})},submitForm:function(form,data){var _this=this;""===data.email||""===data.message?_this.warnInvalid(form):(_this.unwarnInvalid(form),_this.makeRequest(data,form),$("#support-submit").attr("disabled","disabled"))},warnInvalid:function(form){$(form).addClass("invalid")},unwarnInvalid:function(form){$(form).removeClass("invalid")},makeRequest:function(data,form){var _this=this,requestData={action:"send_enquiry",nonce:data.nonce,data:data};$.ajax({url:WP.ajaxUrl,type:"post",data:requestData,success:function(response,status){_this.handleResponse(response,status,form)}})},handleResponse:function(response,status,form){var _this=this;"error"===response.type?_this.handleError(response.error,form):"success"===response.type&&$(form).addClass("thanks"),$("#support-submit").attr("disabled","false")},handleError:function(error,form){console.log("Error!",error),$(form).addClass("error"),$("#support-messages .message-error").text(error.message)}},Site.init();
//# sourceMappingURL=main.min.js.map
