Site={mobileThreshold:601,scrollToSpeed:300,init:function(){var _this=this;$(window).resize(function(){_this.onResize()}),$(document).ready(function(){$("#portraits").length&&(Site.Portraits.init(),Site.Player.init(),Site.Map.init()),$(".paypal-form-holder").length&&Site.Paypal.init(),$(".swiper-container").length&&Site.Gallery.init(),$(".js-menu-toggle").on("click",function(){$("#mobile-menu").toggleClass("open")})})},onResize:function(){},fixWidows:function(){$(".js-fix-widows").each(function(){var string=$(this).html();string=string.replace(/ ([^ ]*)$/,"&nbsp;$1"),$(this).html(string)})}},Site.Gallery={instances:[],options:{pagination:".swiper-pagination",loop:!0,slidesPerView:"auto",loopedSlides:5,spaceBetween:0,paginationClickable:!0,centeredSlides:!0,onTap:function(swiper){swiper.slideNext()}},init:function(){var _this=this;$(".swiper-container").each(function(index,element){_this.instances[index]=new Swiper(element,_this.options)})}},Site.Paypal={init:function(){var _this=this;$(".paypal-form-holder form").each(function(){_this.styleForm($(this))}),$(".paypal-form-holder").removeClass("u-hidden")},styleBuy:function($buy){},styleForm:function($form){var $buy=$form.find('input[name="submit"]'),$select=$form.find("select");$buy.attr("type","submit"),$buy.attr("value","Buy"),$buy.wrap('<div class="grid-item item-s-6"></div>'),$select.length&&($form.prepend($select),$form.find("table").remove(),$select.wrap('<div class="grid-item item-s-6"></div>'))}},Site.Player={playerOptions:{controls:0,modestbranding:1,rel:0,title:0,showinfo:0,fs:0},init:function(){var _this=this;1==WP.wp_debug&&1==WP.isAdmin&&(_this.playerOptions.controls=1),_this.$wrapper=$("#player-container"),_this.$container=$("#portraits"),_this.bind(),$(window).on("load",function(){$("body").removeClass("loading")})},setVideosList:function(list){var _this=this;list&&(_this.list=list)},bind:function(){var _this=this;window.onYouTubePlayerAPIReady=_this.initYoutube.bind(_this),$(window).on("updatedyoutubelist",function(event,data){_this.setVideosList(data.youtubeIds)})},initYoutube:function(){var _this=this;_this.player=new YT.Player("player-iframe",{playerVars:_this.playerOptions}),$(window).resize(_this.onResize.bind(_this)),_this.player.addEventListener("onReady",_this.handleVideoReady.bind(this)),_this.player.addEventListener("onStateChange",_this.handleVideoStateChange.bind(this)),$(window).resize(_this.onResize.bind(_this))},handleVideoReady:function(event){Site.Portraits.checkHash()},handleVideoStateChange:function(event){var _this=this;switch(event.data){case-1:_this.fadeOut();break;case 0:_this.fadeOut(),_this.list&&_this.nextVideo();break;case 1:_this.fadeIn();break;case 3:_this.fadeOut()}},fadeOut:function(){this.$container.removeClass("show")},fadeIn:function(){this.$container.addClass("show")},openVideo:function(){var _this=this;_this.$container.addClass("video"),_this.sizeIframe()},closeVideo:function(){this.$container.removeClass("video")},scrollIn:function(){$("body").scrollTo(0,Site.scrollToSpeed)},playVideo:function(videoId,list){var _this=this;_this.openVideo(),_this.player.loadVideoById(videoId),void 0!==list&&_this.setVideosList(list)},nextVideo:function(){var _this=this,currentVideo=_this.player.getVideoData();if(currentVideo=_this.list.indexOf(currentVideo.video_id),_this.list.length>currentVideo+1){var nextVideo=_this.list[currentVideo+1];_this.playVideo(nextVideo)}else _this.closeVideo()},sizeIframe:function(){var _this=this,windowWidth=$(window).width(),windowHeight=$(window).height(),headerHeight=$("#header").outerHeight(),filterHeight=$("#portraits-filters-container").outerHeight(),landscapeIframeHeight=windowHeight-(headerHeight+filterHeight),portraitIframeHeight=windowWidth/16*9;_this.$container.hasClass("video")&&(windowWidth<=windowHeight/9*16&&portraitIframeHeight<=landscapeIframeHeight?($("#player-wrapper").css({height:portraitIframeHeight}),$("#player-iframe").css({width:"100%"})):($("#player-wrapper").css({height:landscapeIframeHeight}),$("#player-iframe").css({width:landscapeIframeHeight/9*16})))},onResize:function(){this.sizeIframe()}},Site.Portraits={init:function(){var _this=this;_this.$form=$("#portraits-filters"),_this.$filters=_this.$form.find("select"),_this.$grid=$("#portraits-grid"),_this.$portraits=_this.$grid.find(".portrait"),_this.initGrid(),_this.bind()},initGrid:function(){var _this=this;_this.$grid.shuffle=new window.Shuffle(_this.$grid,{itemSelector:".portrait",sizer:"#portrait-sizer"}),_this.$grid[0].addEventListener("load",function(){var runs,update=function(){_this.$grid.shuffle.layout(),runs=!1};return function(){runs||(runs=!0,setTimeout(update,33))}}(),!0)},bind:function(){var _this=this;_this.$filters=$(".filter-select").on("change",_this.handleFilterChange.bind(_this)),$(window).on("hashchange",_this.handleHashChange.bind(_this)),_this.$grid.on("arrangeComplete",_this.handleArrangeComplete.bind(_this))},checkHash:function(){var _this=this,hash=location.hash.split("/");if("portrait"===hash[1]){var videoId=hash[hash.length-1],list=_this.getFilteredYoutubeIds();Site.Player.playVideo(videoId,list),Site.Player.scrollIn()}},handleHashChange:function(event){this.checkHash()},getFilteredYoutubeIds:function(){return $(".shuffle-item--visible").toArray().map(function(val){return val.dataset.youtubeId})},handleArrangeComplete:function(event){var _this=this,youtubeIds=_this.getFilteredYoutubeIds();$(window).trigger("updatedyoutubelist",{youtubeIds:youtubeIds})},handleFilterChange:function(event){var _this=this,filterArray=_this.getFilterArray();_this.$grid.shuffle.filter(filterArray)},getFilterArray:function(){var _this=this,filterArray=[];return _this.$filters.each(function(index){this.value&&filterArray.push(this.dataset.filter+"-"+this.value)}),filterArray}},Site.Map={options:{center:{lat:-34.397,lng:150.644},minZoom:2,icon:{},styles:[{elementType:"geometry.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{elementType:"geometry.stroke",stylers:[{color:"#000000"},{visibility:"off"},{weight:.5}]},{elementType:"labels.text.fill",stylers:[{color:"#000000"}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]}]},dataStyle:{fillColor:"white",strokeWeight:1},markers:[],geoJSONURL:WP.themeUrl+"/dist/static/countries.geo.json",init:function(){var _this=this;_this.options.icon={url:WP.themeUrl+"/dist/img/truth-bubble.png",scaledSize:new google.maps.Size(75.5,55),anchor:new google.maps.Point(0,55)},_this.$grid=$("#portraits-grid"),_this.$portraits=_this.$grid.find(".portrait"),_this.$wrapper=$("#map-portraits-wrapper"),_this.$container=$("#map-container"),_this.map=new google.maps.Map(_this.$container[0],_this.options),_this.map.data.loadGeoJson(_this.geoJSONURL),_this.map.data.setStyle(_this.dataStyle);var bounds=new google.maps.LatLngBounds;WP.locations.length&&($(WP.locations).each(function(index,item){_this.markers[index]=new google.maps.Marker({map:_this.map,title:item.name,icon:_this.options.icon,position:{lat:parseInt(item.lat),lng:parseInt(item.lng)}}),_this.markers[index].slug=item.slug,_this.markers[index].addListener("click",function(){_this.playPortraitsByLocation(this.slug)}),bounds.extend(_this.markers[index].getPosition())}),_this.map.setCenter(bounds.getCenter()),google.maps.event.addListenerOnce(_this.map,"bounds_changed",function(event){_this.map.setZoom(_this.map.getZoom()-1),_this.map.getZoom()>13&&_this.map.setZoom(4)}.bind(this)),_this.map.fitBounds(bounds)),_this.bind()},bind:function(){var _this=this;$(".js-toggle-map").on("click",function(event){event.preventDefault(),_this.$wrapper.toggleClass("show-map")})},playPortraitsByLocation:function(location){var _this=this,list=[],filter='[data-groups*="location-'+location+'"]';_this.$portraits.filter(filter).each(function(index,element){list[index]=element.dataset.youtubeId}),Site.Player.playVideo(list[0],list),$("body").scrollTo(0,Site.scrollToSpeed)}},Site.init();
//# sourceMappingURL=main.min.js.map
