{"version":3,"sources":["main.js"],"names":["Site","mobileThreshold","init","_this","this","$","window","resize","onResize","document","ready","length","Portraits","Player","Map","Paypal","Gallery","fixWidows","each","string","html","replace","instances","options","pagination","loop","slidesPerView","loopedSlides","spaceBetween","paginationClickable","centeredSlides","onTap","swiper","slideNext","index","element","Swiper","styleForm","removeClass","styleBuy","$buy","$form","find","$select","attr","wrap","prepend","remove","playerOptions","controls","modestbranding","rel","WP","wp_debug","$playerContainer","bind","setVideosList","list","onYouTubePlayerAPIReady","initYoutube","on","event","data","youtubeIds","player","YT","playerVars","addEventListener","handleVideoStateChange","nextVideo","playVideo","videoId","loadVideoById","currentVideo","getVideoData","indexOf","video_id","console","log","$filters","$grid","$portraits","initGrid","isotope","itemSelector","layoutMode","runs","update","setTimeout","handleFilterChange","handlePortraitClick","handleArrangeComplete","currentTarget","dataset","youtubeId","getFilteredYoutubeIds","map","val","trigger","filterSelector","getFilterSelector","filter","selector","value","center","lat","lng","zoom","markers","$container","google","maps","locations","i","location","Marker","title","name","position","parseInt","slug","addListener","playPortraitsByLocation"],"mappings":"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","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global $, jQuery, document, Site, YT */\n\nSite = {\n  mobileThreshold: 601,\n  init: function() {\n    var _this = this;\n\n    $(window).resize(function(){\n      _this.onResize();\n    });\n\n    $(document).ready(function () {\n\n      if ($('#portraits').length) {\n        // Init grid\n        Site.Portraits.init();\n        // Init player\n        Site.Player.init();\n        // Init Map\n        Site.Map.init();\n      }\n\n      if ($('.paypal-form-holder').length) {\n        Site.Paypal.init();\n      }\n\n      if ($('.swiper-container').length) {\n        // Init any galleries\n        Site.Gallery.init();\n      }\n\n    });\n\n  },\n\n  onResize: function() {\n    var _this = this;\n\n  },\n\n  fixWidows: function() {\n    // utility class mainly for use on headines to avoid widows [single words on a new line]\n    $('.js-fix-widows').each(function(){\n      var string = $(this).html();\n      string = string.replace(/ ([^ ]*)$/,'&nbsp;$1');\n      $(this).html(string);\n    });\n  },\n};\n\nSite.Gallery = {\n  instances: [],\n  options: {\n    pagination: '.swiper-pagination',\n    loop: true,\n    slidesPerView: 'auto',\n    loopedSlides: 5,\n    spaceBetween: 0,\n    paginationClickable: true,\n    centeredSlides: true,\n    onTap: function(swiper) {\n      swiper.slideNext();\n    },\n  },\n\n  init: function() {\n    var _this = this;\n\n    // Find and loop all swiper containers\n    $('.swiper-container').each(function(index, element) {\n      // Create and save instance on instances array\n      _this.instances[index] = new Swiper (element, _this.options);\n    });\n\n  },\n};\n\nSite.Paypal = {\n  init: function() {\n    var _this = this;\n\n    var $form = $('.paypal-form-holder form');\n\n    $form.each(function() {\n      _this.styleForm($(this));\n    });\n\n    $('.paypal-form-holder').removeClass('u-hidden');\n\n  },\n\n  styleBuy: function($buy) {\n\n  },\n\n  styleForm: function($form) {\n    var $buy = $form.find('input[name=\"submit\"]');\n    var $select = $form.find('select');\n\n    // Style Buy button\n    $buy.attr('type', 'submit');\n    $buy.attr('value', 'Buy');\n    $buy.wrap('<div class=\"grid-item item-s-6\"></div>');\n\n    // Style select\n    if ($select.length) {\n      $form.prepend($select);\n      $form.find('table').remove();\n      $select.wrap('<div class=\"grid-item item-s-6\"></div>');\n    }\n  },\n\n};\n\nSite.Player = {\n  playerOptions: {\n    // https://developers.google.com/youtube/player_parameters?playerVersion=HTML5#Parameters\n    controls: 0,\n    modestbranding: 1,\n    rel: 0,\n  },\n\n  init: function() {\n    var _this = this;\n\n    // If WP_DEBUg turn on controls cuz happy Dev :)\n    if(WP.wp_debug) {\n      _this.playerOptions.controls = 1;\n    }\n\n    // Get the player container element\n    _this.$playerContainer = $('#player-iframe');\n\n    // Bind stuff\n    _this.bind();\n\n  },\n\n  setVideosList: function(list) {\n    var _this = this;\n\n    if(list) {\n      _this.list = list;\n    }\n\n  },\n\n  bind: function() {\n    var _this = this;\n\n    // Init youtube whuen youtube api is ready\n    // TODO: subscribe to this event with jQuery\n    window.onYouTubePlayerAPIReady = _this.initYoutube.bind(_this);\n\n    // Listen for updatedyoutubelist\n    $(window).on('updatedyoutubelist', function(event, data) {\n      // Update list cache\n      _this.setVideosList(data.youtubeIds);\n    });\n\n  },\n\n  initYoutube: function() {\n    var _this = this;\n\n    // Init youtube player inside #player-container\n    _this.player = new YT.Player('player-iframe', {\n      playerVars: _this.playerOptions,\n    });\n\n    _this.player.addEventListener('onStateChange', _this.handleVideoStateChange.bind(this));\n\n  },\n\n  handleVideoStateChange: function(event) {\n    var _this = this;\n\n    // 0 = Video ended\n    if(event.data === 0) {\n      // Check if there's list\n      if(_this.list) {\n        _this.nextVideo();\n      }\n    }\n  },\n\n  playVideo: function(videoId, list) {\n    var _this = this;\n\n    // Play video\n    _this.player.loadVideoById(videoId);\n\n    // If passed, update list\n    if(typeof list !== 'undefined') {\n      _this.setVideosList(list);\n    }\n\n  },\n\n  nextVideo: function() {\n    var _this = this;\n\n    // Get current video ID\n    var currentVideo =  _this.player.getVideoData();\n    currentVideo = _this.list.indexOf(currentVideo.video_id);\n\n    // Check if theres more videos to play\n    if (_this.list.length > currentVideo + 1) {\n\n      // Get next video ID\n      var nextVideo = _this.list[currentVideo + 1];\n\n      // Play next video\n      _this.playVideo(nextVideo);\n    } else {\n      // TODO Close video\n      console.log('No more videos');\n    }\n  },\n\n};\n\nSite.Portraits = {\n  init: function() {\n    var _this = this;\n\n    // Get filters form element\n    _this.$form = $('#portraits-filters');\n\n    // Get filters select elements\n    _this.$filters = _this.$form.find('select');\n\n    // Get grid element\n    _this.$grid = $('#portraits-grid');\n\n    // Get portraits\n    _this.$portraits = _this.$grid.find('.portrait');\n\n    // Init grid\n    _this.initGrid();\n\n    // Bind stuff\n    _this.bind();\n\n  },\n\n  initGrid: function() {\n    var _this = this;\n\n    // Set grid with isotope\n    _this.$grid.isotope({\n      // options\n      itemSelector: '.grid-item',\n      layoutMode: 'fitRows'\n    });\n\n    // Workaround to make it compatible with lazysizes\n    _this.$grid[0].addEventListener('load', (function(){\n      var runs;\n      var update = function(){\n        _this.$grid.isotope('layout');\n        runs = false;\n      };\n      return function(){\n        if(!runs){\n          runs = true;\n          setTimeout(update, 33);\n        }\n      };\n    }()), true);\n\n  },\n\n  bind: function() {\n    var _this = this;\n\n    // Bind select filters change\n    _this.$filters = $('.filter-select').on('change', _this.handleFilterChange.bind(_this));\n\n    // Bind portrait clicks\n    _this.$portraits.on('click', _this.handlePortraitClick.bind(this));\n\n    // Bind arrange complete grid event\n    _this.$grid.on('arrangeComplete',_this.handleArrangeComplete.bind(_this));\n  },\n\n  handlePortraitClick: function(event) {\n    var _this = this;\n\n    var videoId = event.currentTarget.dataset.youtubeId;\n\n    var list = _this.getFilteredYoutubeIds();\n\n    // TODO: scroll to video\n    Site.Player.playVideo(videoId, list);\n\n  },\n\n  // Get a list of youtube ids (filtered in the list)\n  getFilteredYoutubeIds: function() {\n    var _this = this;\n\n    // Get the filtered elements\n    var filteredElements = _this.$grid.isotope('getFilteredItemElements');\n\n    // Get youtubeIds\n    var youtubeIds = filteredElements.map( function(val) {\n      return val.dataset.youtubeId;\n    });\n\n    return youtubeIds;\n  },\n\n  handleArrangeComplete: function(event) {\n    var _this = this;\n\n    var youtubeIds = _this.getFilteredYoutubeIds();\n\n    // Trigger an event with the list of youtube Ids\n    $(window).trigger('updatedyoutubelist', {\n      youtubeIds: youtubeIds,\n    });\n\n  },\n\n  handleFilterChange: function(event) {\n    var _this = this;\n\n    // Get the selector text to be used for filtering\n    var filterSelector = _this.getFilterSelector();\n\n    // Filter using the selector on Isotope\n    _this.$grid.isotope({\n      filter: filterSelector,\n    });\n\n  },\n\n  // Return a string selector based on the filter values\n  // Eg. '[data-filters*=age-20]'\n  //     '[data-filters*=age-20][data-filters*=subject-subject-1]'\n  getFilterSelector: function() {\n    var _this = this;\n\n    var selector = '';\n\n    // Iterate thru the filters to get it's values\n    _this.$filters.each( function(index) {\n      if(this.value) {\n\n        // Build up selector string\n        selector += '[data-filters*=' + this.dataset.filter + '-' + this.value + ']';\n      }\n    });\n\n    return selector;\n  },\n\n};\n\nSite.Map = {\n  options: {\n    // TODO: Set coordinates\n    center: {\n      lat: -34.397,\n      lng: 150.644\n    },\n    zoom: 2,\n  },\n  markers: [],\n\n  init: function() {\n    var _this = this;\n\n    // Get grid element\n    // TODO: find a way of not repeating this data here and in Site.Portraits\n    _this.$grid = $('#portraits-grid');\n\n    // Get portraits\n    // TODO: find a way of not repeating this data here and in Site.Portraits\n    _this.$portraits = _this.$grid.find('.portrait');\n\n    // Get map container\n    _this.$container = $('#portraits-map');\n\n    // Init google maps\n    _this.map = new google.maps.Map(_this.$container[0], _this.options);\n\n    // Add a marker for each location\n    if (WP.locations.length) {\n      $(WP.locations).each(function(i) {\n        var location = WP.locations[i];\n        // Add marker\n        _this.markers[i] = new google.maps.Marker({\n          map: _this.map,\n          title: location.name,\n          position: {\n            lat: parseInt(location.lat),\n            lng: parseInt(location.lng),\n          }\n        });\n\n        // Add slug to the marker\n        _this.markers[i].slug = location.slug;\n\n        // Add click listener\n        _this.markers[i].addListener('click', function() {\n          _this.playPortraitsByLocation(this.slug);\n        });\n      });\n    }\n\n  },\n\n  // Play portraits by location\n  playPortraitsByLocation: function(location) {\n    var _this = this;\n\n    // Empty list for youtube IDs\n    var list = [];\n\n    // Filter selector string\n    var filter = '[data-filters*=location-' + location + ']';\n\n    // Filter portraits\n    var $filteredPortraits = _this.$portraits.filter(filter);\n\n    // Save youtube IDs\n    $filteredPortraits.each(function(i) {\n      list[i] = this.dataset.youtubeId;\n    });\n\n    // Play first video, update the list\n    Site.Player.playVideo(list[0], list);\n\n    // TODO: Scroll to player\n\n  },\n};\n\nSite.init();\n"]}